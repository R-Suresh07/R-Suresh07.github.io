<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <h4>Unveiling Precision and Context in Visual Discovery with AI!</h4> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*M8dVgc7AJuywlYqBmptbfA.png"><figcaption>Source: Dall-E 3</figcaption></figure> <p>After OpenAI unveiled GPT-4 Vision on their website in September, I became captivated by the potential applications we could make with access to an API version of this technology. My anticipation was met with excitement today as <a href="https://openai.com/blog/new-models-and-developer-products-announced-at-devday" rel="external nofollow noopener" target="_blank">OpenAI announced the Vision API, accompanied by an array of new models and features, during their Developer Day presentation</a>.</p> <p>One of the compelling applications we can explore is conducting image searches without the need to compare text directly to an image. In this article, I will explain what GPT-4 Vision is, why it’s a game-changer in the realm of visual search, and how I utilized it to streamline the process of searching through images.</p> <p>The GitHub link for the project can be found <a href="https://github.com/R-Suresh07/Image-Search-using-GPT-4-Vision-API.git" rel="external nofollow noopener" target="_blank">here</a>.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*bayqt55irDIs-3Qd.png"><figcaption>Source: <a href="https://www.reddit.com/r/OpenAI/comments/158y87l/gpt4_vision_its_amazing_alpha_users/" rel="external nofollow noopener" target="_blank">GPT-4 vision it’s amazing (Alpha users) : r/OpenAI (reddit.com)</a></figcaption></figure> <p><strong>Problem Statement</strong></p> <p>The primary issue confronting current image search technology is its limited ability to understand and process visual content with the same nuance and depth as human perception. Traditional image search algorithms rely heavily on metadata and image recognition software that can misinterpret the context or content of an image, leading to inaccurate search results.</p> <p>The aim of this article is to demonstrate how GPT-4 Vision can be leveraged to overcome the limitations of conventional image search methods, thereby providing a more intuitive and user-friendly search experience, while also taking into account the cost and policy constraints associated with using such cutting-edge technology.</p> <p><strong>Value Proposition of the project</strong></p> <ol> <li> <strong>Enhanced Accuracy:</strong> By leveraging GPT-4’s advanced understanding of images and language, search results are more aligned with the users’ intent and context of the query.</li> <li> <strong>Contextual Understanding:</strong> GPT-4 Vision goes beyond keyword matching to comprehend the nuances and subtleties within images, thus providing results that account for context and content more deeply.</li> <li> <strong>Efficient Processing:</strong> By converting visual content into text descriptions, the system allows for faster and more efficient comparison of search queries with a database of images, reducing search time.</li> <li> <strong>Innovative Content Interaction:</strong> Users can interact with the search system in novel ways, such as asking complex questions about the contents of an image, which traditional image search engines cannot handle.</li> <li> <strong>Improved User Experience:</strong> By providing more accurate and relevant results, user satisfaction with the image search process is expected to increase.</li> <li> <strong>Reduced Infrastructure Demand:</strong> For businesses, utilizing GPT-4 Vision can mean less reliance on heavy computational infrastructure compared to running their own complex image processing and recognition systems.</li> <li> <strong>Flexibility and Adaptability: </strong>The system is adaptable to various types of image searches, ranging from simple object identification to complex scene descriptions, making it a versatile tool for multiple use cases.</li> <li> <strong>Future-proof Technology:</strong> By incorporating the state-of-the-art AI model, the system is poised to evolve with advancements in AI, ensuring long-term relevance and improvement.</li> </ol> <p><strong>What is GPT-4 Vision?</strong></p> <p>GPT-4 Vision is a type of Visual Question Answering (VQA) model which allows the user to interact with GPT-4 not only through text but through images as well, allowing them to ask questions relating to the images.</p> <p>VQA is a research area in artificial intelligence that combines techniques from computer vision and natural language processing to answer questions about the contents of an image. GPT-4 Vision extends this concept by attaching a Large Language Model(GPT-4) to an image encoder which allows GPT-4 to understand visual information from images in addition to the textual information it already handles.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/761/1*s5jlquZuvu5iWoWhsenV2g.png"><figcaption>Source: <a href="https://www.researchgate.net/publication/328128164_A_Novel_Approach_on_Visual_Question_Answering_by_Parameter_Prediction_using_Faster_Region_Based_Convolutional_Neural_Network" rel="external nofollow noopener" target="_blank">(PDF) A Novel Approach on Visual Question Answering by Parameter Prediction using Faster Region Based Convolutional Neural Network (researchgate.net)</a></figcaption></figure> <p><strong>Why is GPT-4 Vision so significant?</strong></p> <ul> <li>GPT-4 Vision is a major advancement because it uses GPT-4, which is a cutting-edge language model, to understand and analyze images that users upload. This allows it to answer questions about these images more accurately than any other tool currently available.</li> <li>It is versatile and can manage various tasks related to both text and images, such as describing, explaining, summarizing, translating, and generating content. It can also answer complex questions about the information it receives.</li> <li>Moreover, GPT-4 Vision can generate creative content like poems, stories, code, essays, and songs based on the images and text it processes.</li> <li>Safety and responsibility are at the forefront of GPT-4 Vision’s design. It has gone through rigorous testing to ensure it behaves safely, with built-in measures to prevent risks, especially in sensitive areas like identifying people, giving medical advice, or making assumptions without solid evidence.</li> </ul> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*Q96tZY19gckAUKEV"><figcaption>Source:<a href="https://arxiv.org/abs/2303.08774?" rel="external nofollow noopener" target="_blank">[2303.08774] GPT-4 Technical Report (arxiv.org)</a> (Notably, the model is capable not just of recognizing the events in an image but alsoidentifying the humor in them.)</figcaption></figure> <p>The only comparable alternatives currently available are <a href="https://huggingface.co/adept/fuyu-8b" rel="external nofollow noopener" target="_blank">Fuyu-8B</a> and <a href="https://llava-vl.github.io/" rel="external nofollow noopener" target="_blank">LlaVa 1.5</a>, both of which are open-source. You can opt for either if you find that GPT-4 Vision does not meet your specific needs or if you need more control over your data.</p> <p><strong>Conventional Approach</strong></p> <p>In a typical image search algorithm, you might start by transforming the input text into a text embedding and converting the image into image embeddings. These are then compared using a model that operates within a shared embedding space, like <a href="https://openai.com/research/clip" rel="external nofollow noopener" target="_blank">CLIP</a>.</p> <p>However, there are several drawbacks to this approach, including:</p> <ul> <li> <strong>Limited Understanding: </strong>Traditional embedding-based methods may have limited capability in understanding the nuanced relationship between text and images. They might be good at matching direct correlations but can struggle with abstract concepts or interpreting the context of the images.</li> <li> <strong>Data Bias:</strong> The accuracy of embeddings often depends on the data they were trained on. If the dataset has biases or lacks diversity, the search results could be skewed, leading to less accurate or fair outcomes.</li> <li> <strong>Complex Queries:</strong> When users input complex or detailed search queries, these methods might not always provide accurate results because the algorithm may not capture all the nuances in both text and visual content.</li> <li> <strong>Computational Resources:</strong> Generating and comparing embeddings can be resource-intensive, requiring significant computational power, especially when dealing with large image databases.</li> </ul> <p><strong>My Methodology</strong></p> <p>What if we could take a different approach by not directly using an image embedding model? Imagine if we pass our images to GPT-4 Vision and let it describe the images in words first. Then, we could use a superior text embedding model to process these descriptions. By comparing the text embeddings of the input and the image descriptions, we might enhance our results in several ways.</p> <p>Advantages of this new approach include:</p> <ul> <li>Improved Accuracy: GPT-4 Vision can extract details from images more effectively than any open-source VQA model currently available, leading to more precise search results.</li> <li>Reduced Search Time: It is generally faster and requires less computational effort to compare two sets of text embeddings than to compare text embeddings with image embeddings. This is because text embeddings typically have fewer dimensions; for instance, Word2Vec or GloVe models usually have dimensions in the hundreds (e.g., 300 for Word2Vec), while image embeddings from convolutional neural networks can have thousands or even tens of thousands of dimensions.</li> <li>Space Efficiency: Text embeddings also occupy less disk space. Their lower dimensionality means they are more compact compared to the more dimensional image embeddings.</li> </ul> <p><strong>Implementation</strong></p> <p>I am now going to implement an image search for an e-commerce store that specializes in selling luxury commodities such as liquor and perfumes. The dataset will have three columns: skuName, skuDescription, and imageUrls. The skuName will refer to the product name, the skuDescription will contain a 2-3 sentence description provided by the brand, and imageUrl will contain the URL of the product image.</p> <p>The dataset will be available in the GitHub repository <a href="https://github.com/R-Suresh07/Image-Search-using-GPT-4-Vision-API.git" rel="external nofollow noopener" target="_blank">here</a>. Note: The dataset is quite small (only 85 images) as I hit the rate limit for GPT-4 Vision, which is still in preview as of the time of writing this article. You can try scaling it up once it is fully available.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/846/1*TEjnGVdh4jBFqmqhl9Z66Q.png"><figcaption>Sample of the Dataset</figcaption></figure> <p>Now, install all of these prerequisite libraries using pip or conda:</p> <pre>openai<br>numpy<br>pandas<br>matplotlib<br>pillow<br>FlagEmbedding </pre> <p>Let’s import all of these into our python file:</p> <pre>import pandas as pd<br>import numpy as np<br>import matplotlib.pyplot as plt<br>import requests<br>import base64<br>from openai import OpenAI<br>from PIL import Image<br>from FlagEmbedding import FlagModel</pre> <p>Before we proceed, ensure that you have access to GPT-4 Vision. You can do this by visiting OpenAI, creating a paid account, and generating an API key. Once you have your key ready, run the following code once:</p> <pre>import os<br>os.environ['OPENAI_API_KEY'] = 'your-openai-key'</pre> <p>Once you are done with that, let’s add some helper functions.</p> <pre>def load_image(url_or_path):<br>    if url_or_path.startswith("http://") or url_or_path.startswith("https://"):<br>        return Image.open(requests.get(url_or_path, stream=True).raw)<br>    else:<br>        return Image.open(url_or_path)<br>def cosine_similarity(vec1, vec2):<br>    # Compute the dot product of vec1 and vec2<br>    dot_product = np.dot(vec1, vec2)<br>    <br>    # Compute the L2 norm of vec1 and vec2<br>    norm_vec1 = np.linalg.norm(vec1)<br>    norm_vec2 = np.linalg.norm(vec2)<br>    <br>    # Compute the cosine similarity<br>    similarity = dot_product / (norm_vec1 * norm_vec2)<br>    <br>    return similarity</pre> <p>The load_image() function is designed to load images from any URL, whether it's hosted online or located at a local file path. The cosine_similarity() function is employed to calculate the cosine similarity between two vectors. For an in-depth understanding of cosine similarity, please refer to <a href="https://medium.com/@sureshraghu0706/image-aesthetics-quantification-using-openai-clip-7bbb45e00147" rel="external nofollow noopener" target="_blank">my previous article</a>, where I provide a detailed explanation of this concept.</p> <p>Let’s now start the pre-processing stage.</p> <pre>def encode_image(image_path):<br>    with open(image_path, "rb") as image_file:<br>        return base64.b64encode(image_file.read()).decode('utf-8')<br>headers = {<br>        "Content-Type": "application/json",<br>        "Authorization": f"Bearer {api_key}"<br>}<br>client = OpenAI()<br>def question_image(url,query):<br>    if url.startswith("http://")or url.startswith("https://"):<br>        response = client.chat.completions.create(<br>            model="gpt-4-vision-preview",<br>            messages=[<br>            {<br>            "role": "user",<br>            "content": [<br>                {"type": "text", "text": f"{query}"},<br>                    {<br>                    "type": "image_url",<br>                    "image_url": url,<br>                        },<br>                    ],<br>                }<br>            ],<br>          max_tokens=1000,<br>        )<br>        return response.choices[0].message.content<br>    else:<br>        base64_image = encode_image(url)<br>        payload = {<br>            "model": "gpt-4-vision-preview",<br>            "messages": [<br>              {<br>                "role": "user",<br>                "content": [<br>                  {<br>                    "type": "text",<br>                    "text": f"{query}?"<br>                  },<br>                  {<br>                    "type": "image_url",<br>                    "image_url": {<br>                      "url": f"data:image/jpeg;base64,{base64_image}"<br>                    },<br>                  }<br>                ]<br>              }<br>            ],<br>            "max_tokens": 1000<br>        }<br><br>        response = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json=payload)<br>        temp=response.json()<br>        return temp['choices'][0]['message']['content']</pre> <p>The encode_image() function encodes any image into its base64 representation. This step is necessary for offline images that we wish to send to GPT-4 Vision.</p> <p>The question_image() function can take either an image URL or a local file path as input and applies distinct logic based on the nature of the input—whether it's an online resource or an offline file. This is because the payload sent to the OpenAI servers varies with the type of image source. The function requires two parameters: 'url,' which specifies the location of the image, and 'query,' which is the question or prompt related to the image and returns the answer provided by GPT-4 Vision.</p> <pre>data=pd.read_excel(r"image_search_dataset.xlsx")<br>data['imageDescription']=None<br>query="Describe this image to me in detail"<br>for i,row in data.iterrows():<br>    url=row['imageUrl']<br>    try:<br>        response = requests.get(url)<br>        if response.status_code == 200:<br>            desc=question_image(url,query)<br>            data.at[i,'imageDescription']=desc<br>            data.to_excel(r"image_search_dataset.xlsx",index=False)<br>    except requests.exceptions.RequestException:<br>        continue</pre> <p>In the given code, we start by reading our dataset into a variable named data. Next, we create a new column titled imageDescription to hold the descriptions that will be generated by GPT-4 Vision. We then loop through our dataset, and for each image, we check if the URL loads correctly (indicated by a status code of 200). If it does, we send the image URL to GPT-4 Vision with the request, “Describe this image to me in detail.” Upon receiving the description, we capture the response and save it to an Excel file. If a URL fails to load, we skip it and proceed to the next one.</p> <p>Now that we have compiled all of our image descriptions, the next step is to focus on the text embeddings. For this purpose, I referred to the <a href="https://huggingface.co/spaces/mteb/leaderboard" rel="external nofollow noopener" target="_blank">MTEB leaderboard on HuggingFace</a>, a benchmark that evaluates various text embedding models across multiple datasets and provides rankings. From there, I selected the top-performing open-source text embedding model, which is <a href="https://huggingface.co/BAAI/bge-large-en-v1.5" rel="external nofollow noopener" target="_blank">BAAI/bge-large-en-v1.5</a>. This model is particularly adept at managing large volumes of text data. You can choose another model according to your needs if need be. Just be mindful as different embedding models have different dimensionality and speed.</p> <pre>model = FlagModel('BAAI/bge-large-en-v1.5', <br>                  query_instruction_for_retrieval="Represent this sentence for searching relevant passages: ",<br>                  use_fp16=True)</pre> <p>We import bge-large-en-v1.5 through FlagEmbeddings and set the query_instruction_for_retrieval according to the <a href="https://github.com/FlagOpen/FlagEmbedding/tree/master#model-list" rel="external nofollow noopener" target="_blank">author’s recommendation for retrieval tasks</a>. You can also use either Sentence Transformers or HuggingFace pipelines to use this model.</p> <pre>data['embedding']=None<br>for i,row in data.iterrows():<br>    temp=row['skuName']+row['imageDescription']+row['skuDescription']<br>    data.at[i,'embedding']=model.encode(temp)</pre> <p>Next, we loop through the dataframe once more. We construct a string variable named temp that concatenates the skuName, imageDescription, and skuDescription. This temp string is then fed into the bge-large model to generate embeddings. The resulting embeddings are stored back into the corresponding rows of the dataframe.</p> <p>We are finally done with all the pre-processing necessary for the project. Now let’s make the function which will combine all these elements.</p> <pre>def top_5_products(user_input):<br>    user_embedding=model.encode(user_input)<br>    data['scores']=None<br>    for i,row in data.iterrows():<br>        data.at[i,'scores']=cosine_similarity(user_embedding,row['embedding'])<br>    data['scores'] = pd.to_numeric(data['scores'], errors='coerce')<br>    top_5=data.nlargest(5,'scores')<br>    fig, axs = plt.subplots(1, 5, figsize=(15, 3))  <br>    for i, row in enumerate(top_5.iterrows()):<br>        image = load_image(row[1]['imageUrl'])<br>        axs[i].imshow(np.array(image))<br>        axs[i].set_title(f"{row[1]['scores']}")<br>    plt.show()</pre> <p>The top_5_products() function initiates its process by taking a user's query and processing it through the bge-large model to produce a text embedding. We then utilize the cosine_similarity() function, previously defined, to compare this query embedding with all the description embeddings that were generated by GPT-4 Vision. These similarity scores are then added to the dataframe as a new column. Following this, we sort the dataframe to identify the top 5 products with the highest similarity scores and save this subset as top_5. In a live application, this top_5 dataset would be returned to the user. However, for demonstration purposes, I will present the images alongside their corresponding scores in a visual grid format using matplotlib.</p> <p>This was the entire end-to-end process behind designing an image search engine using GPT-4 Vision. Now let’s put this to the test.</p> <p><strong>Results</strong></p> <p>I will evaluate the program using four distinct types of queries: product type, product description, visual attributes, and sensory or unique characteristics. You will be able to review and assess the results firsthand.</p> <p>Query 1: Aberlour Double Cask 12 Year Old (Exact product name)</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1010/1*OhMt_qPgsPscmpEa9qwqtw.png"><figcaption>Query 1 Results (Scores are arranged in descending order, with the highest score on the left and decreasing towards the right)</figcaption></figure> <p>Query 2: Scotch whiskey aged and mellowed (Search based on description)</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1004/1*aH9UEvteX3XBOgZtd48wKA.png"><figcaption>Query 2 Results (Scores descending from left to right)</figcaption></figure> <p>Based on the brand’s description, we can see that Ballantine has been recommended the most by the algorithm.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*KTmJBSWmo0mkUZBkrihKsw.png"><figcaption>Product description of Ballantine 12 YO 100cl</figcaption></figure> <p>Query 3: Tall cylindrical bottle with a deep blue color (Search based on Image description)</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/998/1*KK6tViGNG37msxftbPNFhg.png"><figcaption>Query 3 Results (Scores descending from left to right)</figcaption></figure> <p>We can see from the image description below why the algorithm chose Boss Bottled Night Eau De Toilette 200ml.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*OVkRDY4zcE7pM6gxi4JrFg.png"><figcaption>Image Description of Boss Bottled Night Eau De Toilette 200ml</figcaption></figure> <p>Query 4: Single malt with a sherry cask finish (Sensory attribute)</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1002/1*zOCNmi76xbxgR-2jAZSIHg.png"><figcaption>Query 4 results(Scores descending from left to right)</figcaption></figure> <p>We can see that the algorithm is able to suggest Auchentoshan HeartwoodÂ 100cl because of it’s image description provided by GPT-4 Vision.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*BlbFxDRSsuts7bydyM3j_g.png"><figcaption>Image Description of Auchentoshan HeartwoodÂ 100cl</figcaption></figure> <p><strong>Scope for Improvements</strong></p> <p>While GPT-4 Vision has brought remarkable improvements to image search technology, there are specific areas where further development could enhance its performance and usability:</p> <ul> <li> <strong>Enhanced Text Embedding Models:</strong> Future updates could integrate text embedding models with larger sequence lengths than those of bge-large. This improvement would allow for a richer retention of product information, enhancing the precision of search results.</li> <li> <strong>Advanced Retrieval Techniques:</strong> As the project scales, it would be beneficial to transition from using a dataframe and cosine similarity to employing vector databases with clustering algorithms. This would enable faster and more efficient retrieval of search results, especially in systems with a vast image database.</li> <li> <strong>Cost Optimization Strategies: </strong>Considering the cost of $0.01105 per high-detail image of size 1366px X 768px, exploring cost-saving measures is crucial. Utilizing lower detail settings could reduce expenses significantly, to around $0.85 per 1000 images. However, this cost-cutting could impact the quality of results, necessitating a balance between detail and expense.</li> <li> <strong>Content Policy Adaptations:</strong> GPT-4 Vision’s strict content policy may restrict its ability to describe certain types of images, such as those involving fashion models. Finding alternative solutions that comply with content guidelines yet maintain descriptive accuracy will be essential for broadening the application scope of the technology.</li> <li> <strong>Open-Source Alternatives:</strong> In scenarios where GPT-4 Vision’s costs or content policies pose constraints, open-source alternatives like Fuyu-8B or LlaVa 1.5 could be considered, despite the potential increase in hardware requirements and possible compromise on performance.</li> </ul> <p><strong>Conclusion</strong></p> <p>In summary, the integration of GPT-4 Vision into image search algorithms has the potential to revolutionize the way we interact with and retrieve visual information. This article walked you through the concept of GPT-4 Vision, its underlying mechanism, and a practical application that enhances image search functionality.</p> <p>By employing GPT-4 Vision, we’ve seen that not only can search accuracy be significantly improved by leveraging more descriptive image interpretations, but search efficiency can also be enhanced due to the reduced computational load of comparing text embeddings over traditional image-text comparisons.</p> <p>Moreover, the practical application and testing of this technology across various query types have demonstrated its robustness and versatility, catering to a wide spectrum of informational and sensory attributes.</p> <p>As we stand on the brink of this new era, the implications of such advancements reach far beyond mere convenience. They pave the way for more accessible digital environments, where the visual web can be navigated with the same ease as text-based information, opening up new possibilities for users with visual impairments or those seeking more intuitive search experiences.</p> <p>As we continue to fine-tune and integrate these models into our systems, one thing remains clear: the way we search, discover, and interact with images is set to evolve in extraordinary ways, making the act of finding not just an outcome, but an experience in itself.</p> <h3>Follow For More!</h3> <p><em>I try to implement a lot of theoretical concepts in the ML space, with an emphasis on practical and intuitive applications.</em></p> <p><em>Thanks for reading this article! If you have any questions, I will be happy to answer them. Feel free to message me on my </em><a href="http://linkedin.com/in/suresh-raghu" rel="external nofollow noopener" target="_blank"><em>LinkedIn</em></a><em> or my </em><a href="http://sureshraghu0706@gmail.com/" rel="external nofollow noopener" target="_blank"><em>email</em></a><em> for other queries.</em></p> <p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=e1fc36fca7e8" width="1" height="1" alt=""></p> </body></html>